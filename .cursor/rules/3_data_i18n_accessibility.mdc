---
alwaysApply: true
---

# üåç Data Fetching, i18n & Accessibility

## Data Fetching
- All API via `src/lib/http/client.ts`
- Base URL: `process.env.NEXT_PUBLIC_API_BASE_URL`
- **TanStack Query** for all client-side data fetching
- **HTTP Interceptors** for token management and error handling
- **Rate limiting** with event bus system
- Public-safe RSC only:
```ts
fetch(url, { next: { revalidate: 60, tags: ['posts'] } })
```
- Client hooks: `useQuery()` and `useMutation()` from TanStack Query
- **Query Configuration**: 5min staleTime, 10min gcTime, 3 retries with exponential backoff
- **Provider Setup**: `ReactQueryProvider` with devtools in development
- **Query Keys**: Structured keys like `["article", articleId]`, `["settings", userId]`
- **Error Handling**: Automatic retry with toast notifications via Sonner

## Forms & Validation
- `react-hook-form` + `zod` + shadcn `<Form />` primitives (`components/ui/layout/form.tsx`)
- Disable submit while pending
- Show `FormMessage` for errors
- **Toast notifications** with Sonner for feedback
- Respect mobile ergonomics (spacing, label click area)

## i18n
- All text in `src/i18n/locales/{en,vi}/*.json`
- **9 namespaces**: `auth`, `article`, `common`, `demo`, `home`, `profile`, `toast`, `user`, `write`
- Use `useTranslations('namespace')`
- **Language switching** with dynamic locale switching

## Accessibility
- AA contrast in both themes
- Keyboard nav (Tab, ESC)
- `aria-live="polite"` for async feedback
- `VisuallyHidden` for non-visual labels
- **Focus management** in dialogs and modals
- **Screen reader** friendly components

## Page Metadata & SEO
- **usePageMetadata Hook** (`@/hooks/ui/use-page-metadata`): Update page title, meta tags, Open Graph, Twitter Cards, canonical URL
- Use for all client component pages to improve SEO and social sharing
- Automatically formats title as: `"{title} | MangaSBS"`
- Updates: `document.title`, meta description, OG tags, Twitter Card, canonical link
- **Example:**
```tsx
usePageMetadata({
  title: "Series Title",
  description: "Series description",
  image: "https://example.com/cover.jpg",
  url: "https://example.com/series/123",
  keywords: ["manga", "series"],
  type: "article"
});
```

## Breadcrumb Navigation
- **useBreadcrumb Hook** (`@/hooks/ui/useBreadcrumb`): Automatic breadcrumb generation with i18n support
- **BreadcrumbNav Component** (`@/components/features/navigation/breadcrumb-nav`): Renders breadcrumb navigation
- Supports dynamic params (titles, usernames, IDs) and translation keys
- Translation keys use `nav.breadcrumb.*` in `common.json` namespace
- **Auto-detection:** Automatically matches known routes (organizations, series, segments, articles, user)
- **Custom breadcrumbs:** Pass items array directly to `useBreadcrumb([...])`
- **Example:**
```tsx
const breadcrumbItems = useBreadcrumb(undefined, {
  series_id: seriesId,
  series_title: series?.title,
});
<BreadcrumbNav items={breadcrumbItems} />
```
